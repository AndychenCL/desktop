#!/bin/sh
DEPENDS="python2.5, python2.5-hildon, python2.5-gtk2, python2.5-osso, python2.5-xml"
mkdir -p usr/{bin/,lib/aarddict,share/{applications/hildon/,dbus-1/services/,pixmaps}}
cp ../src/aarddict-maemo.py usr/bin/aarddict || exit
cp -R ../src/aarddict/*.py usr/lib/aarddict || exit
cp ../icons/aarddict.png usr/share/pixmaps/

python ../tools/trimallkeys.py -i ../src/aarddict/allkeys.txt -o usr/lib/aarddict/allkeys.txt

chmod +x usr/bin/aarddict

export LD_LIBRARY_PATH=/usr/lib

DIRS="usr"
find $DIRS| grep \~ && rm -i $(find $DIRS| grep \~)

PACKAGE=aarddict
VERSION=$(grep "^version =" ../src/aarddict/ui.py | sed s/version\ =\ \"// | sed s/\"//)
APP_NAME=$(grep "^app_name =" ../src/aarddict/ui.py | sed s/app_name\ =\ \"// | sed s/\"//)
SIZE=$(du -sc $DIRS|grep total|sed s/total//)

echo $VERSION	

echo "Package: $PACKAGE
Version: $VERSION
Section: user/other
Priority: optional
Architecture: all
Depends: $DEPENDS
Installed-Size: $SIZE
Maintainer: Igor Tkach <itkach@users.sourceforge.net>
Description: A dictionary application for Nokia Internet Tablets." > control
cat control

echo "[Desktop Entry]
Version=$VERSION
Encoding=UTF-8
Name=$APP_NAME
Type=Application
Exec=/usr/bin/aarddict
Icon=aarddict
X-Osso-Service=aarddict
X-Osso-Type=application/x-executable" > usr/share/applications/hildon/aarddict.desktop

echo "[D-BUS Service]
Name=com.nokia.aarddict
Exec=/usr/bin/aarddict" > usr/share/dbus-1/services/aarddict.service

echo 2.0 > debian-binary

tar -zcvf data.tar.gz ./usr 
tar -zcvf control.tar.gz control
NAME="$PACKAGE"-"$VERSION".deb
rm $NAME
ar q $NAME debian-binary control.tar.gz data.tar.gz 
ar t $NAME
ls -al $NAME
rm debian-binary control control.tar.gz data.tar.gz
rm -rfd usr
